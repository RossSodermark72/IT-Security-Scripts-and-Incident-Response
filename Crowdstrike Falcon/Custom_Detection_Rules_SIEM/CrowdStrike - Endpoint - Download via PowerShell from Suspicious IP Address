#repo="base_sensor" #event_simpleName="ProcessRollup2"
| FileName =~ in(values=["powershell.exe", "pwsh.exe", "pwsh"])
| CommandLine=/(?:DownloadFile|New-Object|Invoke|Start-BitsTransfer|Net\.WebClient|iwr|irm|wget|curl)/i
| CommandLine=/\/\/(?<ip_address>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})[:\/]/
| NOT cidr(ip_address, subnet=["169.254.0.0/16", "127.0.0.0/8", "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16"])
| ioc:lookup(ip_address, type="ip_address", confidenceThreshold="unverified", strict="true")

// Identifies a PowerShell process downloading data from a suspicious IP address, by using a look up in CrowdStrike's database of IOCs that have been reported but not yet verified. -Ross Sodermark 10/2025
